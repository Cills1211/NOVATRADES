local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

local unlockBaseGui = nil

local function getHRP()
    local c = LocalPlayer.Character
    if not c then return end
    return c:FindFirstChild("HumanoidRootPart") or c:FindFirstChild("UpperTorso")
end

local function smartInteract(number)
    local char = LocalPlayer.Character
    local hrp = getHRP()
    if not char or not hrp then return end
    
    local plots = Workspace:FindFirstChild("Plots")
    if not plots then return end
    
    local closestPlot, minDistance = nil, 40
    
    for _, plot in pairs(plots:GetChildren()) do
        local plotPos = plot:IsA("Model") and (plot.PrimaryPart and plot.PrimaryPart.Position or plot:GetPivot().Position) or plot.Position
        local dist = (hrp.Position - plotPos).Magnitude
        if dist < minDistance then 
            closestPlot = plot 
            minDistance = dist 
        end
    end
    
    if closestPlot and closestPlot:FindFirstChild("Unlock") then
        local items = {}
        for _, item in pairs(closestPlot.Unlock:GetChildren()) do
            local pos = item:IsA("Model") and item:GetPivot().Position or item.Position
            table.insert(items, {Obj = item, Y = pos.Y})
        end
        
        table.sort(items, function(a, b) return a.Y < b.Y end)
        
        if items[number] then
            for _, pr in pairs(items[number].Obj:GetDescendants()) do
                if pr:IsA("ProximityPrompt") then 
                    fireproximityprompt(pr) 
                end
            end
        end
    end
end

local function toggleUnlockBaseMenu(state)
    if state then
        if unlockBaseGui then unlockBaseGui:Destroy() end
        
        local sg = Instance.new("ScreenGui", CoreGui)
        sg.Name = "UnlockBaseGUI"
        
        local frame = Instance.new("Frame", sg)
        unlockBaseGui = frame
        frame.Size = UDim2.new(0, 160, 0, 60)
        frame.Position = UDim2.new(0.5, -80, 0.1, 0)
        frame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
        frame.Active = true
        frame.Draggable = true
        
        local corner = Instance.new("UICorner", frame)
        corner.CornerRadius = UDim.new(0, 10)
        
        local stroke = Instance.new("UIStroke", frame)
        stroke.Color = Color3.fromRGB(0, 170, 255)
        stroke.Thickness = 1.5

        for i = 1, 3 do
            local btn = Instance.new("TextButton", frame)
            btn.Size = UDim2.new(0, 40, 0, 40)
            btn.Position = UDim2.new(0, 15 + (i-1)*45, 0, 10)
            btn.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
            btn.Text = tostring(i)
            btn.TextColor3 = Color3.fromRGB(200, 200, 255)
            btn.Font = Enum.Font.GothamBold
            btn.TextSize = 20
            btn.AutoButtonColor = true
            
            Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
            
            btn.MouseButton1Click:Connect(function() 
                smartInteract(i) 
            end)
        end
    else
        if unlockBaseGui then
            unlockBaseGui.Parent:Destroy()
            unlockBaseGui = nil
        end
    end
end

toggleUnlockBaseMenu(true)
